<?xml version="1.0" encoding="UTF-8"?>
<!-- DTD지정  -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.itwillbs.mappers.qualityMapper">

<!-- 품질관리 목록 -->
	<select id="qualityList" resultType="com.itwillbs.domain.ProductionVO" >
	    select *
		from production a,
	     	 product b,
	    	 qc q,
	    	 defective d
		where a.product_id = b.product_id
		and a.production_id = q.production_id
		and q.qc_num = d.qc_num
	</select>
<!-- 품질관리 목록 -->

<!-- 검수 상세 -->
	<select id="qualityInfo" resultType="com.itwillbs.domain.ProductionVO">
		select *
		from production a,
	     	 product b,
	    	 qc q,
	    	 defective d
		where a.product_id = b.product_id
		and a.production_id = q.production_id
		and q.qc_num = d.qc_num
		and q.qc_num = #{qc_num}
	</select>
<!-- 검수 상세 -->

<!--    검수 등록    -->
	<!-- 작업지시번호 조회 -->
		<select id="insertSearch" resultType="com.itwillbs.domain.ProductionVO">
			select *
			from production a,
		     	 product b
			where a.product_id = b.product_id
			and a.production_id = #{production_id}
		</select>
	<!-- 작업지시번호 조회 -->
	<!-- 검수번호 최대 값 (maxNumber) 230620004 -->
	    <select id="getMaxNumber" resultType="String">
	        SELECT MAX((SUBSTRING(qc_num, 3)))
			FROM qc;
	    </select>
	 <!-- 검수번호 최대값 (maxNumber) 230620004 -->
	 
	 
	 <!-- DB 검수번호 최대 날짜 (maxDate) == 230620 -->	
	 	<select id="getMaxDate" resultType="String">
	 		SELECT MAX((SUBSTRING(qc_num, 3, 6)))
			FROM qc;
	 	</select>
	 <!-- DB 검수번호 최대 날짜 (maxDate) == 230620 -->
	<!-- 검수 정보 DB등록 -->
		<insert id="qInsertDB">
			insert into qc
			(qc_num, qc_emp, qc_date, qc_qty, qc_state, production_id)
			values (#{qc_num}, #{qc_emp}, now(), #{qc_qty}, '완료', #{production_id})
		</insert>
		<insert id="qInsertDB2" >
			insert into defective
			(qc_num, def_code, def_qty)
			values (#{qc_num},#{def_code},#{def_qty})
		</insert>
	<!-- 검수 정보 DB등록 -->
<!--    검수 등록    -->

<!-- 공병 관리 -->
	<!-- 공병 목록 가져오기 -->
	
	<!-- 공병 목록 가져오기 -->
	<select id="bottleList" resultType="com.itwillbs.domain.ProductionVO">
		select *
			from empty_bottle
	</select>
	<!-- 공병 수량 DB등록 -->
	<insert id="btInsert">
		insert into empty_bottle
		(bt_date,bt_qty)
		values (#{bt_date},#{bt_qty})
	</insert>
	<!-- 공병 수량 DB등록 -->
	<!-- 공병 불량 DB등록 -->
	<update id="btUpdate">
		update empty_bottle
		set bt_defQty = #{bt_defQty}
		where bt_date = date_format(#{bt_date}, '%Y-%m-%d %H:%i:%s')
	</update>
	<!-- 공병 불량 DB등록 -->
	
<!-- 공병 관리 -->


</mapper>